System.setProperty("file.encoding", "UTF-8")

buildscript {
  repositories {
    jcenter()
    maven {
      url "http://sandec.bintray.com/repo"
    }
  }

  dependencies {
    classpath "com.sandec.jpro:jpro-plugin-gradle:$JPRO_VERSION"
    classpath "SANDEC:simplefx-plugin-gradle:$SIMPLEFX_VERSION"
    classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.8.5'
  }
}

configure([project(':core'),project(':example')]) {
  repositories {
    jcenter()
  }

  apply plugin: 'de.sandec.simplefx'
  apply plugin: 'com.sandec.jpro'

  simplefx {
    scalaVersion = "$SCALA_VERSION"
    scalaVersionShort = "$SCALA_VERSION_SHORT"
  }

  apply plugin: 'com.google.osdetector'
  ext.platform = osdetector.os == 'osx' ? 'mac' : osdetector.os == 'windows' ? 'win' : osdetector.os

  dependencies {
    compile "org.openjfx:javafx-base:$JAVAFX_VERSION:$platform"
    compile "org.openjfx:javafx-graphics:$JAVAFX_VERSION:$platform"
    compile "org.openjfx:javafx-controls:$JAVAFX_VERSION:$platform"
    compile "org.openjfx:javafx-fxml:$JAVAFX_VERSION:$platform"
    compile "org.openjfx:javafx-media:$JAVAFX_VERSION:$platform"
    compile "org.openjfx:javafx-web:$JAVAFX_VERSION:$platform"
    compile "org.openjfx:javafx-swing:$JAVAFX_VERSION:$platform"
  }
}

configure([project(':core')]) {
  apply plugin: 'java'
  apply plugin: 'maven-publish'
  apply plugin: 'com.jfrog.bintray'

  dependencies {
    compile "SANDEC:jnodes:$JNODES_VERSION"
    compile "de.sandec:JMemoryBuddy:0.5.0"
  }

  group = 'com.sandec.jpro'
  version = "$JPRO_WEB_VERSION"

  /*
  task packageJavadoc(type: Jar, dependsOn: 'javadoc') {
    from javadoc.destinationDir
    classifier = 'javadoc'
  }
  task packageSources(type: Jar, dependsOn: 'classes') {
    from sourceSets.main.allSource
    classifier = 'sources'
  }
  artifacts {
    archives packageJavadoc
    archives packageSources
  }

  task sourcesJar(type: Jar) {
      from sourceSets.main.allJava
      archiveClassifier.set("sources")
  }*/


  publishing {
    publications {
      mavenJava(MavenPublication) {
        from components.java
        groupId project.group
        artifactId ("jpro-web-" + project.name)
        version project.version
        //artifact sourcesJar
      }
    }
  }

  bintray {
    if(project.hasProperty("BINTRAY_USER")) {
      user = BINTRAY_USER
      key  = BINTRAY_KEY
    }
    publications = ['mavenJava']
    publish = true
    override = true
    pkg {
      repo = 'repo'
      name = "jpro-web-" + project.name
      userOrg = 'sandec'
    }
  }
}



configure([project(':example')]) {
  mainClassName = "example.TestWebApplication"
  dependencies {
    compile project(':core')
    compile 'org.controlsfx:controlsfx:11.0.1'
  }

  compileJava {
    doFirst {
      options.compilerArgs = [
              '--module-path', classpath.asPath,
              '--add-modules', 'javafx.fxml,javafx.controls'
      ]
    }
  }

  run {
    doFirst {
      jvmArgs = [
              '--module-path', classpath.asPath,
              '--add-modules', 'javafx.fxml,javafx.controls'
      ]
    }
  }

  jpro {
    openingPath = "/"
  }
}
